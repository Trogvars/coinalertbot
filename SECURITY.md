# Безопасность Crypto Alert Bot

## Обзор

Этот документ описывает меры безопасности, реализованные в проекте.

## Реализованные меры безопасности

### 1. Валидация входных данных

#### Пользовательский ввод
- Все числовые значения валидируются на корректность и диапазон
- Символы криптовалют санитизируются (только буквы и цифры)
- HTML-контент экранируется для предотвращения XSS
- User ID валидируется на корректный диапазон

#### WebSocket данные
- Проверка типов всех полей из WebSocket сообщений
- Валидация диапазонов (OI, цена, количество)
- Санитизация символов перед обработкой
- Ограничение размера сообщений (10MB)

### 2. WebSocket безопасность

#### SSL/TLS
- Обязательное использование wss:// (WebSocket Secure)
- Проверка SSL сертификатов
- Валидация hostname

#### Ограничения
- Максимум 200 символов за подключение
- Timeout для ping/pong (10 секунд)
- Автоматический reconnect с exponential backoff
- Ограничение размера сообщений

### 3. Защита API

#### Валидация API ключей
- Минимальная длина 32 символа
- Проверка на пустые/пробельные значения
- Хранение в переменных окружения (.env)

#### Rate Limiting
- Ограничение частоты запросов на пользователя
- Конфигурируемые лимиты для разных операций
- Автоматический сброс счетчиков

### 4. Безопасность базы данных

#### SQL Injection
- Использование параметризованных запросов
- Никакой конкатенации SQL
- Валидация всех входных данных

#### Доступ к данным
- Изоляция данных пользователей
- Индексы для оптимизации запросов
- WAL mode для безопасной конкурентной записи

### 5. Конфигурация

#### Переменные окружения
- Все секреты в .env файле
- .env добавлен в .gitignore
- Валидация при запуске

#### Валидация конфигурации
```python
# config/settings.py
def validate(self) -> bool:
    if not self.BOT_TOKEN:
        raise ValueError("BOT_TOKEN is required")
    if not self.COINMARKETCAP_API_KEY:
        raise ValueError("COINMARKETCAP_API_KEY is required")
    return True
```

### 6. Логирование

#### Безопасное логирование
- Никаких API ключей в логах
- Никаких пользовательских данных в логах
- Ротация логов по дням
- Отдельные файлы для ошибок

## Рекомендации по использованию

### Настройка окружения

1. Создайте `.env` файл:
```env
BOT_TOKEN=your_secure_token_here
COINMARKETCAP_API_KEY=your_api_key_here
LOG_LEVEL=INFO
```

2. Установите правильные права доступа:
```bash
chmod 600 .env
```

### Обновления зависимостей

Регулярно обновляйте зависимости:
```bash
pip install --upgrade -r requirements.txt
```

Проверяйте уязвимости:
```bash
pip install safety
safety check
```

### Мониторинг

- Проверяйте логи ошибок регулярно
- Настройте алерты для критических ошибок
- Мониторьте использование ресурсов

## Тестирование безопасности

### Запуск тестов безопасности
```bash
pytest tests/test_security.py -v
```

### Проверка покрытия
```bash
pytest --cov=. --cov-report=html
```

## Известные ограничения

1. **Rate Limiting** - реализован в памяти, сбрасывается при перезапуске
2. **WebSocket** - нет аутентификации на уровне WebSocket (полагаемся на Binance)
3. **Логи** - хранятся локально, нет централизованного сбора

## Сообщение об уязвимостях

Если вы обнаружили уязвимость, пожалуйста:
1. НЕ создавайте публичный issue
2. Свяжитесь с разработчиком напрямую
3. Опишите уязвимость детально
4. Дождитесь исправления перед публикацией

## Чеклист безопасности

- [x] Валидация всех пользовательских вводов
- [x] Санитизация данных из внешних источников
- [x] SSL/TLS для всех WebSocket подключений
- [x] Параметризованные SQL запросы
- [x] API ключи в переменных окружения
- [x] Rate limiting
- [x] Логирование без секретов
- [x] Тесты безопасности
- [ ] Централизованный сбор логов (TODO)
- [ ] Мониторинг и алерты (TODO)

## Обновления безопасности

### v1.1.0 (2025-10-29)
- Добавлена валидация входных данных
- Реализован rate limiting
- Добавлены тесты безопасности
- Улучшена безопасность WebSocket
- SSL/TLS проверка сертификатов

### v1.0.0 (2024)
- Базовая реализация
